---
import "remixicon/fonts/remixicon.css";

import DiaryContent from "../submodules/diary/index.md";
import process from "process";
import path from "path";
import fs from "fs";
import { filesize } from "filesize";
import { POSTS_PATH } from "../constants";
const postsPath = path.resolve(process.cwd(), POSTS_PATH);

const iconMappings = {
	".md": "ri-markdown-line",
};

const files = fs.readdirSync(postsPath);

let markdownFiles = files
	.filter((file) => path.extname(file).toLowerCase() === ".md")
	.map((file) => {
		return {
			icon: iconMappings[path.extname(file).toLowerCase()] ?? "ri-file-unknow-line",
			path: path.join("/posts/", path.parse(file).name),
			name: file,
			size: filesize(fs.statSync(path.resolve(postsPath, file)).size),
		};
	});
---

<html lang="en">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Suraj Yadav</title>
	</head>
	<body>
		<h2>Index of /suraj</h2>
		<table>
			<thead>
				<tr>
					<td>Name</td>
					<td>Size</td>
				</tr>
			</thead>
			<tbody>
				{
					markdownFiles.map(({ icon, name, size, path }) => (
						<tr>
							<td>
								<i class={icon}></i><a href={path} class="post-link">{name}</a>
							</td>
							<td>{size}</td>
						</tr>
					))
				}
			</tbody>
		</table>

		<h3>Archive of Suraj Yadav</h3>
		<DiaryContent />
	</body>
</html>

<style is:global>
	@import url("https://fonts.googleapis.com/css2?family=Courier+Prime&display=swap");

	table {
		font-family: "Courier Prime", monospace;

		width: 72ch;

		border-top: 1px dashed lightgray;
		border-left: 5px solid rgb(102, 102, 102);
		border-right: 1px solid lightgray;
		border-bottom: 1px solid black;
		border-collapse: collapse;

		margin-top: 1rem;
		margin-bottom: 2rem;

		box-shadow: 2px 2px 0px rgb(226, 226, 226);
	}

	th {
		text-align: center;
		font-weight: bold;
		border-bottom: 1px solid black;
	}

	td {
		border: 1px solid lightgray;
		padding-left: 0.5rem;
		word-break: break-word;
	}

	.cell-key {
		width: 30%;
	}

	.post-link {
		border: none;
		padding-left: 0.5rem;
	}
</style>
